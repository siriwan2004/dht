<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pastel Cartoon Weather Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body {
    font-family: 'Poppins', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 1em;
    color: #333;
    transition: background 2s ease; /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ô‡∏∏‡πà‡∏° */
}

/* Fade-in Animation */
@keyframes fadeInUp {
    from { opacity:0; transform: translateY(20px); }
    to { opacity:1; transform: translateY(0); }
}

/* Header */
h1 {
    font-size: 2.4em;
    margin-bottom: 1em;
    text-align: center;
    text-shadow: 1px 1px 6px rgba(0,0,0,0.15);
    animation: fadeInUp 0.6s ease forwards;
    color: #444;
}

/* Cards */
.container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    margin-bottom: 1.5em;
}
.card {
    position: relative;
    background: linear-gradient(145deg, #FFD1DC, #FFB6C1); /* ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏ä‡∏°‡∏û‡∏π gradient */
    border-radius: 30px;
    padding: 2em;
    text-align: center;
    box-shadow: 0 8px 25px rgba(255,182,193,0.4); /* ‡πÄ‡∏á‡∏≤‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
    border: 4px dashed rgba(255,105,180,0.6); /* ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
    color: #333;
    transition: all 0.3s ease;
    animation: fadeInUp 0.6s ease forwards;
}
.card:hover {
    transform: translateY(-5px) rotate(-1deg);
    box-shadow: 0 12px 35px rgba(255,105,180,0.5);
}

.label { font-weight: 600; font-size: 1.3em; margin-bottom: 0.5em; }
.value { font-size: 3.2em; font-weight: 700; }
.unit { font-size: 1.1em; color: #555; }
#temperature-value { color: #FF6B81; }
#humidity-value { color: #33C4BC; }

/* Status message */
.status-message {
    background: linear-gradient(145deg, #FFF1C8, #FFE0A8);
    padding: 14px 22px;
    border-radius: 25px;
    margin-bottom: 1.5em;
    font-weight: 500;
    text-align: center;
    border: 3px dashed rgba(255,180,50,0.5);
    animation: fadeInUp 0.6s ease forwards;
    color: #333;
}

/* Table */
table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 20px;
    overflow: hidden;
    background: linear-gradient(135deg, #C8F7D2, #A8EFC4); /* ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß gradient */
    box-shadow: 0 6px 20px rgba(50,200,180,0.25);
    margin-bottom: 1.5em;
    border: 4px double rgba(50,200,180,0.6); /* ‡πÄ‡∏™‡πâ‡∏ô double line */
}
th, td { padding: 12px 15px; text-align: center; color: #333; }
th { background: rgba(255,255,255,0.2); font-weight: 600; }
tr:hover { background: rgba(255,255,255,0.1); transition: 0.3s; }

/* Chart container */
#chart-container {
    width: 100%;
    padding: 25px;
    background: linear-gradient(145deg, #D0F0FD, #A8E6FF); /* ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏ü‡πâ‡∏≤ gradient */
    border-radius: 30px;
    box-shadow: 0 10px 30px rgba(168,230,255,0.3);
    margin-bottom: 2em;
    border: 4px dashed rgba(51,196,188,0.6);
    animation: fadeInUp 0.6s ease forwards;
}

/* Footer */
.footer {
    margin-top: 2em;
    padding: 15px 30px;
    background: linear-gradient(135deg, #FFF1C8, #FFE0A8); /* ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á gradient */
    border-radius: 20px;
    text-align: center;
    font-weight: 500;
    color: #333;
    box-shadow: 0 8px 25px rgba(255,200,100,0.25);
    border: 3px dashed rgba(255,180,50,0.5);
    animation: fadeInUp 0.6s ease forwards;
}

/* Responsive */
@media (min-width: 600px) {
    .container { flex-direction: row; justify-content: center; }
    .card { flex: 1 1 220px; max-width: 250px; }
}
</style>
</head>
<body>

<h1>üåà Pastel Cartoon Weather Dashboard üåà</h1>

<div class="container">
    <div class="card">
        <div class="label">Temperature üå°Ô∏è</div>
        <div class="value" id="temperature-value">--</div>
        <span class="unit">¬∞C</span>
    </div>
    <div class="card">
        <div class="label">Humidity üíß</div>
        <div class="value" id="humidity-value">--</div>
        <span class="unit">%</span>
    </div>
</div>

<div class="status-message" id="status-message">Loading data...</div>

<h2 style="text-align:center; margin-bottom:0.5em;">History (latest 20 records)</h2>
<table id="history-table">
    <thead>
        <tr>
            <th>Time ‚è∞</th>
            <th>Temp üå°Ô∏è</th>
            <th>Humidity üíß</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div id="chart-container">
    <canvas id="weatherChart"></canvas>
</div>

<!-- Footer -->
<div class="footer">
    <p>Created By : 66030178 & 66030196 üé®</p>
</div>

<script>
const BACKEND_BASE = "https://dht-69wz.onrender.com";
const MAX_HISTORY = 20;

const ctx = document.getElementById('weatherChart').getContext('2d');
const chartData = { 
    labels: [], 
    datasets: [
        { label: 'Temperature (¬∞C)', data: [], borderColor:'#FF6B81', backgroundColor:'rgba(255,107,129,0.25)', tension:0.4 },
        { label: 'Humidity (%)', data: [], borderColor:'#33C4BC', backgroundColor:'rgba(51,196,188,0.25)', tension:0.4 }
    ]
};
const weatherChart = new Chart(ctx,{
    type:'line',
    data: chartData,
    options:{
        responsive:true,
        plugins:{legend:{position:'top'}},
        scales:{x:{title:{display:true,text:'Time'}},y:{beginAtZero:true}}
    }
});

async function loadHistory(){
    try{
        const res = await fetch(`${BACKEND_BASE}/history?limit=${MAX_HISTORY}`, {cache:"no-store"});
        const history = await res.json();
        const tbody = document.querySelector("#history-table tbody");
        tbody.innerHTML = "";
        chartData.labels = [];
        chartData.datasets[0].data = [];
        chartData.datasets[1].data = [];
        history.reverse().forEach(d=>{
            const tr = document.createElement('tr');
            tr.innerHTML=`<td>${new Date(d.at).toLocaleTimeString()}</td>
                          <td>${Number(d.temperature).toFixed(1)}</td>
                          <td>${Number(d.humidity).toFixed(0)}</td>`;
            tbody.appendChild(tr);
            chartData.labels.push(new Date(d.at).toLocaleTimeString());
            chartData.datasets[0].data.push(Number(d.temperature).toFixed(1));
            chartData.datasets[1].data.push(Number(d.humidity).toFixed(0));
        });
        weatherChart.update();
        if(history.length>0){
            document.getElementById('temperature-value').textContent = Number(history[0].temperature).toFixed(1);
            document.getElementById('humidity-value').textContent = Number(history[0].humidity).toFixed(0);
            document.getElementById('status-message').textContent = "Latest data loaded";
        }
    }catch(e){
        console.error(e);
        document.getElementById('status-message').textContent="Failed to load history";
    }
}

async function fetchData(){
    try{
        const res = await fetch(`${BACKEND_BASE}/data`, {cache:"no-store"});
        const data = await res.json();
        if(data.temperature!==null) document.getElementById('temperature-value').textContent = Number(data.temperature).toFixed(1);
        if(data.humidity!==null) document.getElementById('humidity-value').textContent = Number(data.humidity).toFixed(0);

        const tbody = document.querySelector("#history-table tbody");
        const newRow = document.createElement("tr");
        newRow.innerHTML = `<td>${new Date().toLocaleTimeString()}</td>
                            <td>${Number(data.temperature).toFixed(1)}</td>
                            <td>${Number(data.humidity).toFixed(0)}</td>`;
        tbody.insertBefore(newRow, tbody.firstChild);
        if(tbody.rows.length > MAX_HISTORY) tbody.deleteRow(tbody.rows.length - 1);

        const time = new Date().toLocaleTimeString();
        chartData.labels.push(time);
        chartData.datasets[0].data.push(Number(data.temperature).toFixed(1));
        chartData.datasets[1].data.push(Number(data.humidity).toFixed(0));
        if(chartData.labels.length > MAX_HISTORY){
            chartData.labels.shift();
            chartData.datasets[0].data.shift();
            chartData.datasets[1].data.shift();
        }
        weatherChart.update();
    }catch(e){
        console.error(e);
        document.getElementById('status-message').textContent="Error fetching data";
    }
}

// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
function updateBackgroundByTime(){
    const hour = new Date().getHours();
    let bg;
    if(hour>=6 && hour<12) bg = 'linear-gradient(135deg, #FFFAE3, #FFF5C2)';        // ‡πÄ‡∏ä‡πâ‡∏≤
    else if(hour>=12 && hour<18) bg = 'linear-gradient(135deg, #D0F0FD, #A8E6FF)';   // ‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô
    else if(hour>=18 && hour<21) bg = 'linear-gradient(135deg, #FFD1DC, #FFB3C1)';   // ‡πÄ‡∏¢‡πá‡∏ô
    else bg = 'linear-gradient(135deg, #C8F7D2, #A8EFC4)';                           // ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô
    document.body.style.background = bg;
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î
loadHistory();
setInterval(fetchData, 5000);
updateBackgroundByTime();
setInterval(updateBackgroundByTime, 60000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ
</script>

</body>
</html>
